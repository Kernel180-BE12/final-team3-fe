# 템플릿 미리보기 줄바꿈 처리 개선 작업

## 문제점 분석

### 현재 상황
- **파일**: `src/components/generator/ThreePanelLayout.jsx`
- **위치**: 139번째 줄, PreviewPanel 컴포넌트의 템플릿 내용 출력 부분
- **문제**: 템플릿 내용에 포함된 `\n` 문자가 실제 줄바꿈으로 렌더링되지 않고 화면에 그대로 표시됨

### 문제 원인
```jsx
// 현재 코드 (139번째 줄)
<p
  className="text-gray-800 whitespace-pre-wrap"
  dangerouslySetInnerHTML={{
    __html: formatContent(version.content),
  }}
/>
```

**원인 분석:**
1. `dangerouslySetInnerHTML`을 사용하면서 HTML 문자열을 직접 삽입
2. `formatContent()` 함수에서 변수 치환 과정에서 HTML 태그를 포함한 문자열 반환
3. `\n` 문자가 HTML에서는 줄바꿈으로 처리되지 않음 (HTML에서는 `<br>` 태그 필요)
4. `whitespace-pre-wrap` CSS만으로는 HTML 내부의 `\n` 문자 처리 불완전

## 해결 방안

### 1. 추천 방안: formatContent 함수 개선
```jsx
const formatContent = (content) => {
  if (!content) return "";

  let processedContent = content;

  if (showVariables) {
    if (version.variables && version.variables.length > 0) {
      processedContent = version.variables.reduce((acc, variable) => {
        return acc.replace(
          new RegExp(variable.placeholder, "g"),
          variable.variableKey
        );
      }, processedContent);
    }
  } else {
    if (version.variables) {
      processedContent = version.variables.reduce((acc, variable) => {
        const highlightedVar = `<span class="font-bold text-yellow-700 bg-yellow-200 px-1 rounded-sm">${variable.placeholder}</span>`;
        return acc.replace(
          new RegExp(variable.placeholder, "g"),
          highlightedVar
        );
      }, processedContent);
    }
  }

  // \n을 <br> 태그로 변환
  return processedContent.replace(/\n/g, '<br>');
};
```

### 2. 대안 방안: JSX 방식으로 변경
```jsx
// dangerouslySetInnerHTML 대신 일반 텍스트로 처리
<p className="text-gray-800 whitespace-pre-wrap">
  {formatContentForPlainText(version.content)}
</p>

const formatContentForPlainText = (content) => {
  if (!content) return "";

  if (showVariables) {
    if (version.variables && version.variables.length > 0) {
      return version.variables.reduce((acc, variable) => {
        return acc.replace(
          new RegExp(variable.placeholder, "g"),
          variable.variableKey
        );
      }, content);
    }
  }

  // 변수 하이라이트는 별도 처리 필요
  return content;
};
```

## 구현 계획

### 단계 1: formatContent 함수 수정
- **위치**: `ThreePanelLayout.jsx` 102-127번째 줄
- **작업**: `\n` 문자를 `<br>` 태그로 변환하는 로직 추가
- **테스트**: 다양한 줄바꿈 패턴이 포함된 템플릿으로 테스트

### 단계 2: 변수 하이라이트와 줄바꿈 호환성 확인
- **확인 사항**: 변수 치환 과정에서 줄바꿈이 손실되지 않는지 검증
- **테스트 케이스**:
  - 변수 앞뒤로 줄바꿈이 있는 경우
  - 여러 줄에 걸친 변수가 있는 경우
  - 변수가 없는 순수 텍스트의 줄바꿈

### 단계 3: UI 테스트
- **브라우저 테스트**: Chrome, Safari, Firefox에서 줄바꿈 렌더링 확인
- **반응형 테스트**: 모바일 환경에서 줄바꿈 표시 확인
- **다양한 텍스트 길이**: 짧은 텍스트부터 긴 텍스트까지 줄바꿈 동작 확인

## 예상 영향

### 긍정적 영향
- 사용자가 의도한 템플릿 레이아웃 정확히 미리보기 가능
- 실제 카카오톡 알림톡과 동일한 형태로 미리보기 제공
- 사용자 경험 개선

### 주의사항
- `dangerouslySetInnerHTML` 사용 시 XSS 보안 이슈 주의
- HTML 태그가 포함된 사용자 입력에 대한 적절한 이스케이프 처리 필요
- 기존 템플릿 데이터와의 호환성 확인 필요

## 테스트 시나리오

### 1. 기본 줄바꿈 테스트
```
입력: "안녕하세요\n반갑습니다\n감사합니다"
기대결과: 3줄로 표시
```

### 2. 변수와 줄바꿈 조합 테스트
```
입력: "고객명: {고객명}\n주문번호: {주문번호}\n\n감사합니다"
기대결과: 변수 하이라이트와 함께 줄바꿈 정상 표시
```

### 3. 연속 줄바꿈 테스트
```
입력: "첫 줄\n\n\n세 번째 줄"
기대결과: 빈 줄 포함하여 정상 표시
```

## 완료 조건
- [ ] `\n` 문자가 실제 줄바꿈으로 화면에 표시됨
- [ ] 변수 하이라이트 기능과 줄바꿈이 동시에 정상 작동
- [ ] 다양한 브라우저에서 일관된 동작 확인
- [ ] 보안 이슈 없음 확인
- [ ] 기존 템플릿 데이터 호환성 확인

## 추가 개선 사항 (선택사항)
- 템플릿 에디터에서 줄바꿈 입력 시 실시간 미리보기 업데이트
- 줄바꿈 개수 제한 또는 가이드라인 제공
- 템플릿 저장 시 줄바꿈 형식 표준화